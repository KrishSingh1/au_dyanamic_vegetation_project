# Brown
ggplot(dea.fc.sites.plotting, aes(y = npv, x = brown)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100)
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = pv, x = green)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_line()
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = pv, x = green)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Bare
ggplot(dea.fc.sites.plotting, aes(y = bs, x = bare)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Brown
ggplot(dea.fc.sites.plotting, aes(y = npv, x = brown)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = pv, x = green)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Bare
ggplot(dea.fc.sites.plotting, aes(y = bs, x = bare)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Bare
ggplot(dea.fc.sites.plotting, aes(y = bs, x = bare)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
###### AusPlots Vegetation Data exploration advanced ######
## Author: Krish Singh
## Date: 230824
## Purpose: To explore the data in AusPlots focusing on temporal variation
library(ausplotsR)
library(reshape2)
library(ggplot2)
library(dplyr)
library(plotly)
veg.info <- readRDS("../STEP2_VEG_EXTRACTION/site_veg.rds")
growth.form <- readRDS("growth_form_matrix.rds")
growth.form.strata <- growth_form_table(veg.info$veg.PI, m_kind = "percent_cover",
cumulative = FALSE, by_strata = TRUE)
insitu.fractional.cover <- readRDS("AusPlots_fractional_cover.rds")
site.names <- unique(veg.info$site.info$site_location_name)
site.observations <- unique(veg.info$site.info$site_unique)
# Count the number of observations of each site
df <- as.data.frame(t(data.frame(purrr::flatten(lapply(site.observations, strsplit, '-')))))
counts <- c()
for (n in site.names){
counts <- c(counts, sum(df$V1 == n))
}
counts.df <- data.frame(site.names, counts)
sites.revisit.df <- subset(counts.df, counts > 1) # For all revisited data
sites.revisit.2.df <- subset(counts.df, counts == 2) # For sites that were only visited twice
info <- as.data.frame(veg.info$site.info)[,c("site_location_name", "visit_start_date", "site_unique")]
info.revisit.2 <- subset(info, subset = (site_location_name %in% sites.revisit.2.df$site.names))
info.revisit.2$visit_start_date <- as.Date(info.revisit.2$visit_start_date)
info.revisit.2.sorted <- info.revisit.2 %>% arrange(+visit_start_date)
indexes <- c()
for (n in sites.revisit.2.df$site.names){
indexes <- c(indexes, which(info.revisit.2.sorted$site_location_name == n)[1])
}
info.revisit.2.t1 <- info.revisit.2.sorted[indexes,]
info.revisit.2.t2 <- info.revisit.2.sorted[-indexes,]
growth.form$site_unique <- rownames(growth.form)
growth.form.df <- melt(growth.form, id = "site_unique",
variable.name = "growth.form", value.name = "occurance")
growth.form.df.t1 <- merge(growth.form.df, info.revisit.2.t1, by = 'site_unique')
growth.form.df.t2 <- merge(growth.form.df, info.revisit.2.t2, by = 'site_unique')
length(unique(growth.form.df.t1$site_location_name))
length(unique(growth.form.df.t2$site_location_name))
missing_location.t1 <- setdiff(unique(growth.form.df.t1$site_location_name),
unique(growth.form.df.t2$site_location_name))
missing_location.t2 <- setdiff(unique(growth.form.df.t2$site_location_name),
unique(growth.form.df.t1$site_location_name))
growth.form.df.t1.filtered <-subset(growth.form.df.t1,
subset = !(site_location_name %in% missing_location.t1)) %>%
arrange(site_location_name, growth.form)
growth.form.df.t2.filtered <-subset(growth.form.df.t2,
subset = !(site_location_name %in% missing_location.t2)) %>%
arrange(site_location_name, growth.form)
# Check if the column values for growth form and site_location_name are identitcal
all(growth.form.df.t1.filtered$growth.form == growth.form.df.t2.filtered$growth.form) ==
all(growth.form.df.t1.filtered$site_location_name == growth.form.df.t2.filtered$site_location_name)
growth.form.change.df <- merge(growth.form.df.t1.filtered, growth.form.df.t2.filtered, by = c("site_location_name", "growth.form"))
change.p <- ggplot(growth.form.change.df ,map = aes(x = occurance.x, y = occurance.y,
colour =  growth.form)) + geom_point() + geom_abline()
ggplotly(change.p, tooltip = c("occurance.x", "occurance.y",
"growth.form", "visit_start_date.x",
"visit_start_date.y"))
change.p <- ggplot(growth.form.change.df ,map = aes(x = occurance.x, y = occurance.y,
colour =  growth.form)) + geom_point() + geom_abline() + geom_smooth()
ggplotly(change.p, tooltip = c("occurance.x", "occurance.y",
"growth.form", "visit_start_date.x",
"visit_start_date.y"))
ggplotly(change.p, tooltip = c("occurance.x", "occurance.y",
"growth.form", "visit_start_date.x",
"visit_start_date.y"))
growth.form.strata$site_unique <- rownames(growth.form.strata)
growth.form.starta.df <- melt(growth.form.strata, id = "site_unique",
variable.name = "strata", value.name = "percentage_cover")
growth.form.strata.t1 <- merge(growth.form.starta.df,
info.revisit.2.t1, by = 'site_unique')
growth.form.strata.t2 <- merge(growth.form.starta.df,
info.revisit.2.t2, by = 'site_unique')
missing_location.t1 <- setdiff(unique(growth.form.strata.t1$site_location_name), unique(growth.form.strata.t2$site_location_name))
missing_location.t2 <- setdiff(unique(growth.form.strata.t2$site_location_name), unique(growth.form.strata.t1$site_location_name))
growth.form.strata.t1.filtered <-subset(growth.form.strata.t1, subset = !(site_location_name %in% missing_location.t1)) %>%
arrange(site_location_name, strata)
growth.form.strata.t2.filtered <-subset(growth.form.strata.t2, subset = !(site_location_name %in% missing_location.t2)) %>%
arrange(site_location_name, strata)
growth.form.strata.change <- merge(growth.form.strata.t1, growth.form.strata.t2, by = c("site_location_name", "strata"))
change.p <- ggplot(growth.form.strata.change,
map = aes(x = percentage_cover.x, y = percentage_cover.y,
colour =  strata)) + geom_point() + geom_abline()
ggplotly(change.p)
?growth_form_table
change.p <- ggplot(growth.form.strata.change ,map = aes(x = percentage_cover.x, y = percentage_cover.y,
colour =  strata)) + geom_point() + geom_abline() +
facet_grid(~strata)
ggplotly(change.p)
library(ausplotsR)
library(reshape2)
library(ggplot2)
library(dplyr)
library(plotly)
veg.info <- readRDS("../STEP2_VEG_EXTRACTION/site_veg.rds")
growth.form <- readRDS("growth_form_matrix.rds")
growth.form.strata <- growth_form_table(veg.info$veg.PI, m_kind = "percent_cover",
cumulative = FALSE, by_strata = TRUE)
insitu.fractional.cover <- readRDS("AusPlots_fractional_cover.rds")
site.names <- unique(veg.info$site.info$site_location_name)
site.observations <- unique(veg.info$site.info$site_unique)
# Count the number of observations of each site
df <- as.data.frame(t(data.frame(purrr::flatten(lapply(site.observations, strsplit, '-')))))
counts <- c()
for (n in site.names){
counts <- c(counts, sum(df$V1 == n))
}
counts.df <- data.frame(site.names, counts)
sites.revisit.df <- subset(counts.df, counts > 1) # For all revisited data
sites.revisit.2.df <- subset(counts.df, counts == 2) # For sites that were only visited twice
info <- as.data.frame(veg.info$site.info)[,c("site_location_name", "visit_start_date", "site_unique")]
info.revisit.2 <- subset(info, subset = (site_location_name %in% sites.revisit.2.df$site.names))
info.revisit.2$visit_start_date <- as.Date(info.revisit.2$visit_start_date)
info.revisit.2.sorted <- info.revisit.2 %>% arrange(+visit_start_date)
indexes <- c()
for (n in sites.revisit.2.df$site.names){
indexes <- c(indexes, which(info.revisit.2.sorted$site_location_name == n)[1])
}
info.revisit.2.t1 <- info.revisit.2.sorted[indexes,]
info.revisit.2.t2 <- info.revisit.2.sorted[-indexes,]
growth.form$site_unique <- rownames(growth.form)
growth.form.df <- melt(growth.form, id = "site_unique",
variable.name = "growth.form", value.name = "occurance")
growth.form.df.t1 <- merge(growth.form.df, info.revisit.2.t1, by = 'site_unique')
growth.form.df.t2 <- merge(growth.form.df, info.revisit.2.t2, by = 'site_unique')
length(unique(growth.form.df.t1$site_location_name))
length(unique(growth.form.df.t2$site_location_name))
missing_location.t1 <- setdiff(unique(growth.form.df.t1$site_location_name),
unique(growth.form.df.t2$site_location_name))
missing_location.t2 <- setdiff(unique(growth.form.df.t2$site_location_name),
unique(growth.form.df.t1$site_location_name))
growth.form.df.t1.filtered <-subset(growth.form.df.t1,
subset = !(site_location_name %in% missing_location.t1)) %>%
arrange(site_location_name, growth.form)
growth.form.df.t2.filtered <-subset(growth.form.df.t2,
subset = !(site_location_name %in% missing_location.t2)) %>%
arrange(site_location_name, growth.form)
# Check if the column values for growth form and site_location_name are identitcal
all(growth.form.df.t1.filtered$growth.form == growth.form.df.t2.filtered$growth.form) ==
all(growth.form.df.t1.filtered$site_location_name == growth.form.df.t2.filtered$site_location_name)
growth.form.change.df <- merge(growth.form.df.t1.filtered, growth.form.df.t2.filtered, by = c("site_location_name", "growth.form"))
View(growth.form.change.df)
library(ausplotsR)
library(reshape2)
library(ggplot2)
library(dplyr)
library(plotly)
veg.info <- readRDS("../STEP2_VEG_EXTRACTION/site_veg.rds")
growth.form <- readRDS("growth_form_matrix.rds")
growth.form.strata <- growth_form_table(veg.info$veg.PI, m_kind = "percent_cover",
cumulative = FALSE, by_strata = TRUE)
insitu.fractional.cover <- readRDS("AusPlots_fractional_cover.rds")
site.names <- unique(veg.info$site.info$site_location_name)
site.observations <- unique(veg.info$site.info$site_unique)
# Count the number of observations of each site
df <- as.data.frame(t(data.frame(purrr::flatten(lapply(site.observations, strsplit, '-')))))
counts <- c()
for (n in site.names){
counts <- c(counts, sum(df$V1 == n))
}
counts.df <- data.frame(site.names, counts)
sites.revisit.df <- subset(counts.df, counts > 1) # For all revisited data
sites.revisit.2.df <- subset(counts.df, counts == 2) # For sites that were only visited twice
info <- as.data.frame(veg.info$site.info)[,c("site_location_name", "visit_start_date", "site_unique")]
info.revisit.2 <- subset(info, subset = (site_location_name %in% sites.revisit.2.df$site.names))
info.revisit.2$visit_start_date <- as.Date(info.revisit.2$visit_start_date)
info.revisit.2.sorted <- info.revisit.2 %>% arrange(+visit_start_date)
indexes <- c()
for (n in sites.revisit.2.df$site.names){
indexes <- c(indexes, which(info.revisit.2.sorted$site_location_name == n)[1])
}
info.revisit.2.t1 <- info.revisit.2.sorted[indexes,]
info.revisit.2.t2 <- info.revisit.2.sorted[-indexes,]
growth.form$site_unique <- rownames(growth.form)
growth.form.df <- melt(growth.form, id = "site_unique",
variable.name = "growth.form", value.name = "occurance")
growth.form.df.t1 <- merge(growth.form.df, info.revisit.2.t1, by = 'site_unique')
growth.form.df.t2 <- merge(growth.form.df, info.revisit.2.t2, by = 'site_unique')
length(unique(growth.form.df.t1$site_location_name))
length(unique(growth.form.df.t2$site_location_name))
missing_location.t1 <- setdiff(unique(growth.form.df.t1$site_location_name),
unique(growth.form.df.t2$site_location_name))
missing_location.t2 <- setdiff(unique(growth.form.df.t2$site_location_name),
unique(growth.form.df.t1$site_location_name))
growth.form.df.t1.filtered <-subset(growth.form.df.t1,
subset = !(site_location_name %in% missing_location.t1)) %>%
arrange(site_location_name, growth.form)
growth.form.df.t2.filtered <-subset(growth.form.df.t2,
subset = !(site_location_name %in% missing_location.t2)) %>%
arrange(site_location_name, growth.form)
# Check if the column values for growth form and site_location_name are identitcal
all(growth.form.df.t1.filtered$growth.form == growth.form.df.t2.filtered$growth.form) ==
all(growth.form.df.t1.filtered$site_location_name == growth.form.df.t2.filtered$site_location_name)
growth.form.change.df <- merge(growth.form.df.t1.filtered, growth.form.df.t2.filtered, by = c("site_location_name", "growth.form"))
?growth_form_table
### Plot 1: Individual growth forms
change.p <- ggplot(growth.form.change.df ,map = aes(x = occurance.x, y = occurance.y,
colour =  growth.form)) + geom_point() + geom_abline() + geom_smooth()
ggplotly(change.p, tooltip = c("occurance.x", "occurance.y",
"growth.form", "visit_start_date.x",
"visit_start_date.y"))
growth.form.strata$site_unique <- rownames(growth.form.strata)
growth.form.starta.df <- melt(growth.form.strata, id = "site_unique",
variable.name = "strata", value.name = "percentage_cover")
growth.form.strata.t1 <- merge(growth.form.starta.df,
info.revisit.2.t1, by = 'site_unique')
growth.form.strata.t2 <- merge(growth.form.starta.df,
info.revisit.2.t2, by = 'site_unique')
missing_location.t1 <- setdiff(unique(growth.form.strata.t1$site_location_name), unique(growth.form.strata.t2$site_location_name))
missing_location.t2 <- setdiff(unique(growth.form.strata.t2$site_location_name), unique(growth.form.strata.t1$site_location_name))
growth.form.strata.t1.filtered <-subset(growth.form.strata.t1, subset = !(site_location_name %in% missing_location.t1)) %>%
arrange(site_location_name, strata)
growth.form.strata.t2.filtered <-subset(growth.form.strata.t2, subset = !(site_location_name %in% missing_location.t2)) %>%
arrange(site_location_name, strata)
growth.form.strata.change <- merge(growth.form.strata.t1, growth.form.strata.t2, by = c("site_location_name", "strata"))
### Plot 2 - Strata together
change.p <- ggplot(growth.form.strata.change,
map = aes(x = percentage_cover.x, y = percentage_cover.y,
colour =  strata)) + geom_point() + geom_abline()
ggplotly(change.p)
change.p <- ggplot(growth.form.strata.change ,map = aes(x = percentage_cover.x, y = percentage_cover.y,
colour =  strata)) + geom_point() + geom_abline() +
facet_grid(~strata)
library(ggplot2)
Original <- read.csv(file = "dea_fc_sites_nearest.csv")
#opaque.fc <- fractional_cover(veg.PI = veg.info$veg.PI, in_canopy_sky = "TRUE")
#dea.fc.sites.plotting <- merge(dea.fc.sites.nearest, opaque.fc, by = 'site_unique')
dea.fc.sites.nearest <- read.csv("dea_fc_sites_nearest_pixel_inc.csv")
dea.fc.sites.plotting <- merge(dea.fc.sites.nearest, insitu.fractional.cover, by = 'site_unique')
dea.fc.sites.plotting <- subset(dea.fc.sites.plotting, subset = (npixels > 100 & npixels <= 121))
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = pv, x = green)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Bare
ggplot(dea.fc.sites.plotting, aes(y = bs, x = bare)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Brown
ggplot(dea.fc.sites.plotting, aes(y = npv, x = brown)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = (pv+npv), x = (green+brown)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = (pv+npv), x = (green+brown))) + geom_point() + geom_abline() +
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = (pv+npv), x = (green+brown))) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
View(dea.fc.sites.nearest)
Metrics::rmse(actual = dea.fc.sites.plotting$green,
predicted = dea.fc.sites.plotting$pv)
Metrics::rmse(actual = dea.fc.sites.plotting$bare,
predicted = dea.fc.sites.plotting$bs)
Metrics::rmse(actual = dea.fc.sites.plotting$brown,
predicted = dea.fc.sites.plotting$npv)
Metrics::rmse(actual = dea.fc.sites.plotting$bare,
predicted = dea.fc.sites.plotting$bs)
Metrics::rmse(actual = dea.fc.sites.plotting$brown,
predicted = dea.fc.sites.plotting$npv)
Metrics::rmse(actual = dea.fc.sites.plotting$green,
predicted = dea.fc.sites.plotting$pv)
Metrics::rmse(actual = dea.fc.sites.plotting$bare,
predicted = dea.fc.sites.plotting$bs)
Metrics::rmse(actual = dea.fc.sites.plotting$bare,
predicted = dea.fc.sites.plotting$bs)
# Brown
ggplot(dea.fc.sites.plotting, aes(y = npv, x = brown)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Bare
ggplot(dea.fc.sites.plotting, aes(y = bs, x = bare)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
View(dea.fc.sites.plotting)
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = pv, x = green, colour = diff)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = pv, x = green, colour = diff)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100)
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = pv, x = green, colour = abs(diff) )) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100)
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = pv, x = green, colour = abs(diff) )) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + theme_classic()
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = pv, x = green, colour = abs(diff) )) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100)
dea.fc.sites.nearest <- read.csv("dea_fc_sites_nearest_pixel_inc.csv")
dea.fc.sites.plotting <- merge(dea.fc.sites.nearest, insitu.fractional.cover, by = 'site_unique')
directory <- "/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/DataExtraction/BACKUP_DATA/csv_files"
files <- list.files(directory, pattern = "\\.csv$", full.names = FALSE)
fileNames <- tools::file_path_sans_ext(files)
veg.info <- readRDS("../STEP2_VEG_EXTRACTION/site_veg.rds")
insitu.fractional.cover <- readRDS("AusPlots_fractional_cover.rds")
library(ggplot2)
dea.fc.sites.nearest <- read.csv("dea_fc_sites_nearest_pixel_inc.csv")
dea.fc.sites.plotting <- merge(dea.fc.sites.nearest, insitu.fractional.cover, by = 'site_unique')
dea.fc.sites.plotting <- subset(dea.fc.sites.plotting, subset = (npixels > 100 & npixels <= 121))
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = pv, x = green)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100)
Metrics::rmse(actual = dea.fc.sites.plotting$green,
predicted = dea.fc.sites.plotting$pv)
# Bare
ggplot(dea.fc.sites.plotting, aes(y = bs, x = bare)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Bare
ggplot(dea.fc.sites.plotting, aes(y = bs, x = bare)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100)
# Brown
ggplot(dea.fc.sites.plotting, aes(y = npv, x = brown)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Brown
ggplot(dea.fc.sites.plotting, aes(y = npv, x = brown)) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100)
Metrics::rmse(actual = dea.fc.sites.plotting$bare,
predicted = dea.fc.sites.plotting$bs)
Metrics::rmse(actual = dea.fc.sites.plotting$brown,
predicted = dea.fc.sites.plotting$npv)
Metrics::rmse(actual = dea.fc.sites.plotting$bare,
predicted = dea.fc.sites.plotting$bs)
Metrics::rmse(actual = dea.fc.sites.plotting$green,
predicted = dea.fc.sites.plotting$pv)
Metrics::rmse(actual = dea.fc.sites.plotting$brown,
predicted = dea.fc.sites.plotting$npv)
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = (pv+npv), x = (green+brown))) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100) + geom_smooth()
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = (pv+npv), x = (green+brown))) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100)
Metrics::rmse(actual = dea.fc.sites.plotting$brown + dea.fc.sites.plotting$green,
predicted = dea.fc.sites.plotting$npv + dea.fc.sites.plotting$pv)
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = (pv+npv), x = (green+brown))) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100)
Metrics::rmse(actual = dea.fc.sites.plotting$brown + dea.fc.sites.plotting$green,
predicted = dea.fc.sites.plotting$npv + dea.fc.sites.plotting$pv)
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = (pv+npv), x = (green+brown))) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100)
Metrics::rmse(actual = dea.fc.sites.plotting$brown + dea.fc.sites.plotting$green,
predicted = dea.fc.sites.plotting$npv + dea.fc.sites.plotting$pv)
# Greenness
ggplot(dea.fc.sites.plotting, aes(y = (pv+npv), x = (green+brown))) + geom_point() + geom_abline() +
xlim(0,100) + ylim(0,100)
Metrics::rmse(actual = dea.fc.sites.plotting$brown + dea.fc.sites.plotting$green,
predicted = dea.fc.sites.plotting$npv + dea.fc.sites.plotting$pv)
Metrics::rmse(actual = dea.fc.sites.plotting$brown + dea.fc.sites.plotting$green,
predicted = dea.fc.sites.plotting$npv + dea.fc.sites.plotting$pv)
?ausPlotsR
?ausplotsR
?ausplotsR
library(ausplotsR)
?https://cmi.ga.gov.au/data-products/dea/629/dea-fractional-cover-landsat
?ausplotsR
directory <- "/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/DataExtraction/BACKUP_DATA/csv_files"
files <- list.files(directory, pattern = "\\.csv$", full.names = FALSE)
fileNames <- tools::file_path_sans_ext(files)
veg.info <- readRDS("../STEP2_VEG_EXTRACTION/site_veg.rds")
insitu.fractional.cover <- readRDS("AusPlots_fractional_cover.rds")
View(insitu.fractional.cover)
ausplots.fc.i.index <- grep("NSABBS0003", insitu.fractional.cover$site_unique)
ausplots.fc.i <- insitu.fractional.cover[ausplots.fc.i.index,]
View(ausplots.fc.i)
dea.file.path <- file.path(directory, paste0("NSABBS0003", ".csv"))
dea.file.path <- file.path(directory, paste0("NSABBS0003", ".csv"))
dea.fc.i <- read.csv(dea.file.path)
dea.fc.i$time <- as.Date(dea.fc.i$time)
View(dea.fc.i)
View(ausplots.fc.i)
ausplots.info.i.index <- grep("NSABBS0003-58581", veg.info$site.info$site_unique)
ausplots.date.i <- as.Date(veg.info$site.info$visit_start_date[ausplots.info.i.index])
times.forwards <- seq(ausplots.date.i, by='1 days', length = 31)
times.backwards <- seq(ausplots.date.i, by='-1 days', length = 31)
timestamp.nearest <- get_nearest_timestep(forward.nearest, backwards.nearest)
get_1_directional_nearest_timestep <- function(time.seq, dea.fc.input, aus.date.input) {
na <- T
for (d in time.seq) {
subsetter <- subset(dea.fc.input, subset = (time == d))
if(nrow(subsetter) > 0 & mean(is.na(subsetter$pv)) < 0.3 ) {
na <- F
break
}
}
if(na) {
return(c(NA, NA))
}
time.stamp <- paste(subsetter$time[1])
time.diff <-  as.numeric(difftime(subsetter$time[1], aus.date.input,
units = 'days'))
return(c(time.stamp, time.diff))
}
get_nearest_timestep <- function(fowards.nearest, backwards.nearest) {
is.for.na <- is.na(fowards.nearest[2])
is.bac.na <- is.na(backwards.nearest[2])
if(is.for.na & is.bac.na){
timestamp.nearest <- c(NA,NA)
} else if (is.for.na) {
timestamp.nearest <- backwards.nearest
} else if (is.bac.na) {
timestamp.nearest <- forward.nearest
} else if (as.numeric(forward.nearest[2]) < abs(as.numeric((backwards.nearest[2])))) {
timestamp.nearest <- forward.nearest
} else {
timestamp.nearest <- backwards.nearest
}
return(timestamp.nearest)
}
trim_to_nearest_coord <- function(ausplots.info.i.index, veg.info, dea.fc.i ) {
# Site End Points:
W.site <- veg.info$site.info$pit_marker_easting[ausplots.info.i.index]
S.site <- veg.info$site.info$pit_marker_northing[ausplots.info.i.index]
N.site <- S.site + 100
E.site <- W.site + 100
#print(W.site)
# Remote End Points:
E.remote.incre <- unique(dea.fc.i$x)
N.remote.incre <- unique(dea.fc.i$y)
# Find Closest Points:
W.closest <- E.remote.incre[which.min(abs(E.remote.incre - W.site))]
E.closest <- E.remote.incre[which.min(abs(E.remote.incre - E.site))]
N.closest <- N.remote.incre[which.min(abs(N.remote.incre - N.site))]
S.closest <- N.remote.incre[which.min(abs(N.remote.incre - S.site))]
#print(W.closest)
#print(E.closest)
#print(N.closest)
#print(S.closest)
# Trim dataset:
trimmed <- subset(dea.fc.i, subset = (x >= W.closest & x <= E.closest &
y >= S.closest & y <= N.closest))
#print(unique(trimmed$x))
#print(unique(trimmed$y))
return(trimmed)
}
forward.nearest <- get_1_directional_nearest_timestep(times.forwards,
dea.fc.i, ausplots.date.i)
backwards.nearest <- get_1_directional_nearest_timestep(times.backwards,
dea.fc.i, ausplots.date.i)
timestamp.nearest <- get_nearest_timestep(forward.nearest, backwards.nearest)
dea.fc.nearest <- trim_to_nearest_coord(ausplots.info.i.index, veg.info, dea.fc.i)
View(dea.fc.nearest)
agg.time.series <- lapply(dea.fc.nearest[,c("bs","pv","npv","ue")], mean)
View(agg.time.series)
agg.time.series <- lapply(dea.fc.nearest[,c("bs","pv","npv","ue")], mean, na.rm = T)
View(agg.time.series)
agg.time.series <- aggregate(dea.fc.nearest[,c("bs","pv","npv","ue")] ~ dea.fc.nearest$time, mean, na.rm = T)
View(agg.time.series)
View(dea.fc.nearest)
agg.time.series <- aggregate(dea.fc.nearest[,c("time", "bs", "pv", "npv", "ue")],
by = list(time),
FUN = mean, na.rm = T)
agg.time.series <- aggregate(dea.fc.nearest[,c("time", "bs", "pv", "npv", "ue")],
by = list(dea.fc.nearest$time),
FUN = mean, na.rm = T)
sds <- lappy(agg.time.series[,c("bs", "pv", "npv", "ue")], mean, na.rm = T)
sds <- lapply(agg.time.series[,c("bs", "pv", "npv", "ue")], mean, na.rm = T)
View(sds)
sds <- lapply(agg.time.series[,c("bs", "pv", "npv", "ue")], sd, na.rm = T)
means <- lapply(agg.time.series[,c("bs", "pv", "npv", "ue")], mean, na.rm = T)
View(sds)
?sd
sds - means
sds <- as.matrix(lapply(agg.time.series[,c("bs", "pv", "npv", "ue")], sd, na.rm = T))
means <- as.matrix(lapply(agg.time.series[,c("bs", "pv", "npv", "ue")], mean, na.rm = T))
View(means)
sds - means
sds <- matrix(lapply(agg.time.series[,c("bs", "pv", "npv", "ue")], sd, na.rm = T))
means <- matrix(lapply(agg.time.series[,c("bs", "pv", "npv", "ue")], mean, na.rm = T))
sds - means
View(sds)
sds <- mapply(agg.time.series[,c("bs", "pv", "npv", "ue")], sd, na.rm = T)
sds <- mapply(agg.time.series[,c("bs", "pv", "npv", "ue")], FUN = sd, na.rm = T)
sds <- apply(agg.time.series[,c("bs", "pv", "npv", "ue")], FUN = sd, na.rm = T)
sds <- mapply(agg.time.series[,c("bs", "pv", "npv", "ue")], FUN = sd, na.rm = T)
sds[["bs"]]
means <- mapply(agg.time.series[,c("bs", "pv", "npv", "ue")], mean, na.rm = T)
means <- mapply(agg.time.series[,c("bs", "pv", "npv", "ue")], FUN = mean, na.rm = T)
sds - means
(agg.time.series[,c("bs", "pv", "npv", "ue")] - means)
(agg.time.series[,c("bs", "pv", "npv", "ue")] - means)/sds
zscores <- (agg.time.series[,c("bs", "pv", "npv", "ue")] - means)/sds
View(zscores)
zscore.timestamp <- zscores[which(agg.time.series$time == timestamp.nearest)]
zscore.timestamp <- zscores[which(agg.time.series$time == timestamp.nearest),]
View(zscore.timestamp)
