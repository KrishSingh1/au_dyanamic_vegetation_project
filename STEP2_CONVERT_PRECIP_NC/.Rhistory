write.csv(data.export, "../DATASETS/Climate_Gridded/Precip/NSANAN0002_1987_2022.csv")
#### Convert NC to csv ####
## Krish Singh
## 07022024
##
# Library -----------------------------------------------------------------
library(ncdf4)
library(data.table)
# Functions ---------------------------------------------------------------
get_precip_data <- function(site.focus, directory) {
precip.path <- file.path(directory, "precip")
nc.path <- file.path(precip.path, paste0(site.focus, "_1987_2022.nc"))
nc <- nc_open(filename = nc.path)
time.var <- ncvar_get(nc, "time")
dates <- as.Date(time.var, origin = "1850-01-01")
var <- ncvar_get(nc, 'precip')
daily.precip <- data.table(precip = var, time = dates)
return(daily.precip)
}
# Main --------------------------------------------------------------------
directory <- "C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/DataExtraction/BACKUP_DATA/ausplots_agcd"
data.export <- get_precip_data('NSAMDD0002', directory = directory)
write.csv(data.export, "../DATASETS/Climate_Gridded/Precip/NSANAN0002_1987_2022.csv")
nc <- nc_open(filename = nc.path)
source("C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/STEP2_CONVERT_PRECIP_NC/Convert_NC.R")
source("C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/STEP2_CONVERT_PRECIP_NC/Convert_NC.R")
source("C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/STEP2_CONVERT_PRECIP_NC/Convert_NC.R")
View(data.export.tmax)
View(data.export.precip)
View(data.export.tmax)
source("C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/STEP2_CONVERT_PRECIP_NC/Convert_NC.R")
source("C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/STEP2_CONVERT_PRECIP_NC/Convert_NC.R")
source("C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/STEP2_CONVERT_PRECIP_NC/Convert_NC.R")
return(daily.tmax)
source("C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/STEP2_CONVERT_PRECIP_NC/Convert_NC.R")
source("C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/STEP2_CONVERT_PRECIP_NC/Convert_NC.R")
site.list
site.unique.names
source("C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/STEP2_CONVERT_PRECIP_NC/Convert_NC.R")
# This is for initial subset dataset
site.list <- read.csv('../DATASETS/Sites_Subset_20231010/ausplots_site_info/sites_subset.csv')
site.unique.names <- unique(site.list$site_location_name)
climate.variables <- c('precip', 'tmax', 'tmin', 'vapourpres_h09', 'vapourpres_h15') # climate variables of interest
directory <- "C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/DataExtraction/BACKUP_DATA/ausplots_agcd"
variable.path <- file.path(directory, 'vapourpres_h15')
nc.path <- file.path(variable.path, paste0(site.focus, "_1987_2022.nc"))
nc.path <- file.path(variable.path, paste0(site.unique.names[1], "_1987_2022.nc"))
nc <- nc_open(filename = nc.path)
time.var <- ncvar_get(nc, "time")
library(ncdf4)
library(data.table)
nc <- nc_open(filename = nc.path)
time.var <- ncvar_get(nc, "time")
dates <- as.Date(time.var, origin = "1850-01-01")
# Account for exception for naming scheme for vapourpres
variable_split <- strsplit(variable_name, split = "_")[[1]][[1]]
if(variable_split == 'vapourpres'){
var <- ncvar_get(nc, variable_split)
} else {
var <- ncvar_get(nc, variable_name)
}
# Account for exception for naming scheme for vapourpres
variable_split <- strsplit(variable_name, split = "_")[[1]][[1]]
# Account for exception for naming scheme for vapourpres
variable_split <- strsplit('vapourpres_h15', split = "_")[[1]][[1]]
if(variable_split == 'vapourpres'){
var <- ncvar_get(nc, variable_split)
} else {
var <- ncvar_get(nc, variable_name)
}
View(nc)
View(nc)
# This is for initial subset dataset
site.list <- read.csv('../DATASETS/Sites_Subset_20231010/ausplots_site_info/sites_subset.csv')
site.unique.names <- unique(site.list$site_location_name)
climate.variables <- c('precip', 'tmax', 'tmin', 'vapourpres_h09', 'vapourpres_h15') # climate variables of interest
directory <- "C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/DATASETS/ausplots_agcd/"
variable.path <- file.path(directory, 'precip')
nc.path <- file.path(variable.path, paste0(site.focus, "_1980_2022.nc"))
nc.path <- file.path(variable.path, paste0('NSANAN0002', "_1980_2022.nc"))
nc <- nc_open(filename = nc.path)
ibrary(ncdf4)
library(ncdf4)
library(data.table)
variable.path <- file.path(directory, 'precip')
nc.path <- file.path(variable.path, paste0('NSANAN0002', "_1980_2022.nc"))
nc <- nc_open(filename = nc.path)
View(nc)
nc[["dim"]][["time"]][["units"]]
time.var <- ncvar_get(nc, "time")
dates <- as.Date(time.var, origin = "1850-01-01")
dates
dates[-1]
dates[length(dates)]
dates[1]
source("C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/STEP2_CONVERT_PRECIP_NC/Convert_NC.R")
source("C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/STEP2_CONVERT_PRECIP_NC/Convert_NC.R")
directory <- "/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/DataExtraction/BACKUP_DATA/csv_files"
library(ncdf4)
library(data.table)
get_nc_data <- function(site.focus, directory, variable_name){
variable.path <- file.path(directory, variable_name)
nc.path <- file.path(variable.path, paste0(site.focus, "_1980_2022.nc")) # initially 1987
nc <- nc_open(filename = nc.path)
time.var <- ncvar_get(nc, "time")
dates <- as.Date(time.var, origin = "1850-01-01")
# Account for exception for naming scheme for vapourpres
variable_split <- strsplit(variable_name, split = "_")[[1]][[1]]
if(variable_split == 'vapourpres'){
var <- ncvar_get(nc, variable_split)
} else {
var <- ncvar_get(nc, variable_name)
}
daily.variable <- data.table(variable_name = var, time = dates)
return(daily.variable)
}
# This is for initial subset dataset
site.list <- read.csv('../DATASETS/Sites_Subset_20231010/ausplots_site_info/sites_subset.csv')
directory <- "/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/DataExtraction/BACKUP_DATA/csv_files"
files <- list.files(directory, pattern = "\\.csv$", full.names = FALSE)
fileNames <- tools::file_path_sans_ext(files)
for (site.name in fileNames) {
file.output.name <- paste0(site.name, '_1980_2022.csv') # get name of file
for(variable in climate.variables){ # for each climate variable, export the associated site data
data.export.precip <- get_nc_data(site.focus = site.name, directory = directory, variable_name = variable) # get data
colnames(data.export.precip)[colnames(data.export.precip) == 'variable_name'] <- variable # rename variable column
write.csv(data.export.precip, paste0("../DATASETS/Climate_Gridded/", variable, "/", file.output.name))  # write to csv
print(paste0("Exported ",variable," data for ",site.name))
}
}
directory <- "/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/DataExtraction/BACKUP_DATA/csv_files"
files <- list.files(directory, pattern = "\\.csv$", full.names = FALSE)
fileNames <- tools::file_path_sans_ext(files)
climate.variables <- c('precip', 'tmax', 'tmin', 'vapourpres_h09', 'vapourpres_h15') # climate variables of interest
for (site.name in fileNames) {
file.output.name <- paste0(site.name, '_1980_2022.csv') # get name of file
for(variable in climate.variables){ # for each climate variable, export the associated site data
data.export.precip <- get_nc_data(site.focus = site.name, directory = directory, variable_name = variable) # get data
colnames(data.export.precip)[colnames(data.export.precip) == 'variable_name'] <- variable # rename variable column
write.csv(data.export.precip, paste0("../DATASETS/Climate_Gridded/", variable, "/", file.output.name))  # write to csv
print(paste0("Exported ",variable," data for ",site.name))
}
}
library(ncdf4)
library(data.table)
get_nc_data <- function(site.focus, directory, variable_name){
variable.path <- file.path(directory, variable_name)
nc.path <- file.path(variable.path, paste0(site.focus, "_1980_2022.nc")) # initially 1987
nc <- nc_open(filename = nc.path)
time.var <- ncvar_get(nc, "time")
dates <- as.Date(time.var, origin = "1850-01-01")
# Account for exception for naming scheme for vapourpres
variable_split <- strsplit(variable_name, split = "_")[[1]][[1]]
if(variable_split == 'vapourpres'){
var <- ncvar_get(nc, variable_split)
} else {
var <- ncvar_get(nc, variable_name)
}
daily.variable <- data.table(variable_name = var, time = dates)
return(daily.variable)
}
file.list.dir <- "/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/DataExtraction/BACKUP_DATA/csv_files"
files <- list.files(file.list.dir, pattern = "\\.csv$", full.names = FALSE)
fileNames <- tools::file_path_sans_ext(files)
directory <- "C:/Users/krish/Desktop/DYNAMIC MODEL VEGETATION PROJECT/au_dyanamic_vegetation_project/DATASETS/ausplots_agcd/"
climate.variables <- c('precip', 'tmax', 'tmin', 'vapourpres_h09', 'vapourpres_h15') # climate variables of interest
for (site.name in fileNames) {
file.output.name <- paste0(site.name, '_1980_2022.csv') # get name of file
for(variable in climate.variables){ # for each climate variable, export the associated site data
data.export.precip <- get_nc_data(site.focus = site.name, directory = directory, variable_name = variable) # get data
colnames(data.export.precip)[colnames(data.export.precip) == 'variable_name'] <- variable # rename variable column
write.csv(data.export.precip, paste0("../DATASETS/Climate_Gridded/", variable, "/", file.output.name))  # write to csv
print(paste0("Exported ",variable," data for ",site.name))
}
}
